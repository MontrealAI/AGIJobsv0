# Owner Control Surface (Production)

> **Audience:** Contract owners, Safe signers, change managers, and auditors.
>
> **Goal:** Document every privileged entry point available to the AGI Jobs v2 owner, show how those knobs are exercised through tooling, and provide verification steps that prove the chain matches the approved manifests.

---

## Governance architecture

- **Timelock-first control.** Contracts that inherit [`Governable`](../contracts/v2/Governable.sol) only accept privileged calls from the configured `TimelockController`. Ownership transfers go through `setGovernance` / `transferOwnership`, so rotating the Safe or timelock automatically propagates to every downstream module.【F:contracts/v2/Governable.sol†L11-L61】
- **Two-step owner facades.** Modules that rely on `Ownable2Step` publish `transferOwnership` and `acceptOwnership`, preventing accidental loss of control and aligning with Safe multi-sig flows.
- **OwnerConfigurator event bus.** Governance batches configuration actions through [`OwnerConfigurator`](../contracts/v2/admin/OwnerConfigurator.sol), which emits `ParameterUpdated(module, parameter, oldValue, newValue, actor)` for every call. The helper accepts single or batched requests so non-technical operators can stage identical changes in production and staging before executing.【F:contracts/v2/admin/OwnerConfigurator.sol†L9-L120】
- **System-wide circuit breaker.** [`SystemPause`](../contracts/v2/SystemPause.sol) centralises pauser rights, letting the owner stop or resume all core modules (`pauseAll` / `unpauseAll`), refresh module pausers after ownership changes, and forward validation failovers from a single address.【F:contracts/v2/SystemPause.sol†L152-L236】

---

## Control catalogue

Each row maps a contract to its privileged setters (grouped by capability) and the automation that applies and verifies the change. Use the exact module keys in `config/owner-control.json` with the `owner:update-all` and `owner:verify-control` scripts.

| Domain | Contract | Privileged controls | Apply via | Verify via |
| --- | --- | --- | --- | --- |
| **Job lifecycle & identity** | [`JobRegistry`](../contracts/v2/JobRegistry.sol) | Module wiring (`setIdentityRegistry`, `setDisputeModule`, `setValidationModule`, `setAuditModule`, `setStakeManager`, `setReputationEngine`, `setCertificateNFT`); identity roots (`setAgentRootNode`, `setAgentMerkleRoot`, `bumpAgentAuthCacheVersion`, `setValidatorRootNode`, `setValidatorMerkleRoot`, `setAgentAuthCacheDuration`); economic knobs (`setFeePool`, `setTreasury`, `setJobStake`, `setMinAgentStake`, `setFeePct`, `setValidatorRewardPct`, `setMaxJobReward`, `setJobDurationLimit`, `setMaxActiveJobsPerAgent`, `setExpirationGracePeriod`, `setTaxPolicy`, `setJobParameters`); safety (`setPauser`, `pause`, `unpause`, `delistJob`, `setAcknowledger`).【F:contracts/v2/JobRegistry.sol†L464-L1357】 | `npm run owner:update-all -- --only jobRegistry` | `npm run owner:verify-control -- --modules jobRegistry` |
| | [`IdentityRegistry`](../contracts/v2/IdentityRegistry.sol) | ENS integration (`setENS`, `setNameWrapper`, `setAgentRootNode`, `setClubRootNode`, `setNodeRootNode` plus alias management); allowlists (`setAgentMerkleRoot`, `setValidatorMerkleRoot`, `addAdditionalAgent`, `addAdditionalValidator`, `addAdditionalNodeOperator`); attestation metadata (`setReputationEngine`, `setAttestationRegistry`, `setAgentType`, profile URI setters).【F:contracts/v2/IdentityRegistry.sol†L222-L706】 | `npm run owner:update-all -- --only identityRegistry` | `npm run owner:verify-control -- --modules identityRegistry` |
| | [`ValidationModule`](../contracts/v2/ValidationModule.sol) | Windows & committee sizing (`setCommitWindow`, `setRevealWindow`, `setValidatorBounds`, `setValidatorsPerJob`, `setMinValidators`, `setMaxValidators`); penalties & thresholds (`setNonRevealPenalty`, `setRevealQuorum`, `setValidatorSlashingPct`, `setApprovalThreshold`, `setRequiredValidatorApprovals`, `setAutoApprovalTarget`); wiring (`setJobRegistry`, `setStakeManager`, `setIdentityRegistry`, `setReputationEngine`); failovers (`triggerFailover`, `resetSelection`); safety (`setPauser`, `pause`, `unpause`).【F:contracts/v2/ValidationModule.sol†L246-L806】【F:contracts/v2/ValidationModule.sol†L1832-L1849】 | `npm run owner:update-all -- --only validationModule` | `npm run owner:verify-control -- --modules validationModule` |
| | [`DisputeModule`](../contracts/v2/modules/DisputeModule.sol) & [`KlerosDisputeModule`](../contracts/v2/modules/KlerosDisputeModule.sol) | Court wiring (`setArbitratorCommittee`, `setTaxPolicy`, `setArbitrator`), economics (`setDisputeFee`, `setAppealWindow`, `setMaxRounds`), ACL (`setModerator`, `removeModerator`, `setPauser`).【F:contracts/v2/modules/DisputeModule.sol†L161-L338】【F:contracts/v2/modules/KlerosDisputeModule.sol†L59-L109】 | `npm run owner:update-all -- --only disputeModule` | `npm run owner:verify-control -- --modules disputeModule` |
| **Capital & incentives** | [`StakeManager`](../contracts/v2/StakeManager.sol) | Treasury routing (`setTreasury`, `setTreasuryAllowlist`, `setFeePool`, `setFeePct`, `setBurnPct`, `setValidatorRewardPct`, `setOperatorSlashPct`); staking rules (`setRoleMinimum`, `setRoleMinimums`, `setMinStake`, `setUnbondingPeriod`, `setMaxStakePerAddress`, `setStakeRecommendations`, `setMaxAGITypes`, `setMaxTotalPayoutPct`, `addAGIType`, `removeAGIType`, `autoTuneStakes`); module wiring (`setJobRegistry`, `setDisputeModule`, `setValidationModule`, `setValidatorLockManager`, `setModules`); pausing & funding (`setPauser`, `pause`, `unpause`, `fundOperatorRewardPool`).【F:contracts/v2/StakeManager.sol†L493-L1708】【F:contracts/v2/StakeManager.sol†L2500-L2857】 | `npm run owner:update-all -- --only stakeManager` | `npm run owner:verify-control -- --modules stakeManager` |
| | [`FeePool`](../contracts/v2/FeePool.sol) | Reward routing (`setRewarder`, `setRewardRole`, `setStakeManager`, `setBurnPct`, `setTreasury`, `setTreasuryAllowlist`, `setTaxPolicy`); governance linkage (`setGovernance`); pausing (`setPauser`, `pause`).【F:contracts/v2/FeePool.sol†L154-L445】【F:contracts/v2/FeePool.sol†L588-L606】 | `npm run owner:update-all -- --only feePool` | `npm run owner:verify-control -- --modules feePool` |
| | [`RewardEngineMB`](../contracts/v2/RewardEngineMB.sol) | Thermodynamic tuning (`setRoleShare`, `setKappa`, `setMu`, `setBaselineEnergy`, `setTemperature`, `setThermostat`); wiring (`setTreasury`, `setFeePool`, `setReputationEngine`, `setEnergyOracle`, `setSettler`); operational caps (`setMaxProofs`).【F:contracts/v2/RewardEngineMB.sol†L112-L227】 | `npm run owner:update-all -- --only rewardEngine` | `npm run owner:verify-control -- --modules rewardEngine` |
| | [`Thermostat`](../contracts/v2/Thermostat.sol) & [`HamiltonianMonitor`](../contracts/v2/HamiltonianMonitor.sol) | PID parameters (`setPID`, `setSystemTemperature`, `setTemperatureBounds`, `setIntegralBounds`, `setRoleTemperature`, `unsetRoleTemperature`, `tick`); Hamiltonian window & history management (`setWindow`, `resetHistory`, `record`).【F:contracts/v2/Thermostat.sol†L52-L133】【F:contracts/v2/HamiltonianMonitor.sol†L49-L82】 | `npm run thermostat:update -- --execute`<br>`npm run hamiltonian:update -- --execute` | `npm run owner:verify-control -- --modules thermostat,hamiltonianMonitor` |
| | [`GovernanceReward`](../contracts/v2/GovernanceReward.sol) | Epoch cadence and treasury links (`setEpochLength`, `setRewardPct`, `setFeePool`, `setStakeManager`, `setRewardRole`, `recordVoters`, `finalizeEpoch`).【F:contracts/v2/GovernanceReward.sol†L91-L142】 | `npm run owner:update-all -- --only governanceReward` | `npm run owner:verify-control -- --modules governanceReward` |
| **Signals & oracles** | [`EnergyOracle`](../contracts/v2/EnergyOracle.sol) | Signer roster management (`setSigner`), report cadence (`setParameters`).【F:contracts/v2/EnergyOracle.sol†L34-L62】 | `npm run owner:update-all -- --only energyOracle` | `npm run owner:pulse -- --network <network>` |
| | [`RandaoCoordinator`](../contracts/v2/RandaoCoordinator.sol) | Commit/reveal schedule (`setCommitWindow`, `setRevealWindow`), deposits (`setDeposit`), payout routing (`setTreasury`, `setToken`).【F:contracts/v2/RandaoCoordinator.sol†L127-L173】 | `npm run owner:update-all -- --only randao` | `npm run owner:pulse -- --network <network>` |
| | [`TaxPolicy`](../contracts/v2/TaxPolicy.sol) | Policy content & economics (`setPolicyURI`, `setAcknowledgement`, `setPolicy`, `setCommitWindow`, `setRevealWindow`, `setDeposit`, `setTreasury`, `setToken`).【F:contracts/v2/TaxPolicy.sol†L85-L173】 | `npm run owner:update-all -- --only taxPolicy` | `npm run owner:verify-control -- --modules taxPolicy` |
| **Platform operations** | [`PlatformRegistry`](../contracts/v2/PlatformRegistry.sol) | Registry ACL (`setPauser`, `setRegistrar`, `setBlacklist`); staking integration (`setStakeManager`, `setReputationEngine`, `setMinPlatformStake`); emergency pause (`pause`, `unpause`).【F:contracts/v2/PlatformRegistry.sol†L76-L454】 | `npm run owner:update-all -- --only platformRegistry` | `npm run owner:verify-control -- --modules platformRegistry` |
| | [`PlatformIncentives`](../contracts/v2/PlatformIncentives.sol) | Discount curves (`setMaxDiscountPct`) and registry wiring (`setConfig`).【F:contracts/v2/PlatformIncentives.sol†L77-L95】 | `npm run owner:update-all -- --only platformIncentives` | `npm run owner:verify-control -- --modules platformIncentives` |
| | [`RoutingModule`](../contracts/v2/modules/RoutingModule.sol) & [`JobRouter`](../contracts/v2/modules/JobRouter.sol) | Operator ACLs (`deregister`, `setRegistrar`, `setBlacklist`), stake requirements (`setMinStake`, `setStakeManager`, `setReputationEngine`, `setReputationEnabled`), registry wiring (`setPlatformRegistry`).【F:contracts/v2/modules/RoutingModule.sol†L65-L189】【F:contracts/v2/modules/JobRouter.sol†L87-L155】 | `npm run owner:update-all -- --only routingModule,jobRouter` | `npm run owner:verify-control -- --modules routingModule,jobRouter` |
| | [`DiscoveryModule`](../contracts/v2/modules/DiscoveryModule.sol)`/`[`RevenueDistributor`](../contracts/v2/modules/RevenueDistributor.sol)`/`[`JobEscrow`](../contracts/v2/modules/JobEscrow.sol)`/`[`CertificateNFT`](../contracts/v2/modules/CertificateNFT.sol) | Operator rosters and stake hooks (`deregisterPlatform`, `setStakeManager`, `setMinStake`, `setReputationEngine`); escrow parameters (`setResultTimeout`, `setJobRegistry`, `setRoutingModule`); payout routing (`setTreasury`, `setStakeManager`); metadata (`setBaseURI`, `updateBaseURI`, `lockBaseURI`, `pause`, `unpause`).【F:contracts/v2/modules/DiscoveryModule.sol†L64-L144】【F:contracts/v2/modules/RevenueDistributor.sol†L59-L81】【F:contracts/v2/modules/JobEscrow.sol†L95-L107】【F:contracts/v2/modules/CertificateNFT.sol†L48-L148】 | `npm run owner:update-all -- --only discoveryModule,revenueDistributor,jobEscrow,certificateNFT` | `npm run owner:verify-control -- --modules discoveryModule,revenueDistributor,jobEscrow,certificateNFT` |
| **Safety & pausing** | [`SystemPause`](../contracts/v2/SystemPause.sol) | Module wiring (`setModules`, `refreshPausers`), global pause/ resume (`pauseAll`, `unpauseAll`), validation failover forwarding (`triggerValidationFailover`).【F:contracts/v2/SystemPause.sol†L152-L236】 | `npx hardhat run scripts/v2/updateSystemPause.ts --network <network> --execute` | `npm run owner:verify-control -- --modules systemPause` |

> **Heads-up:** Some helper scripts (for example `thermostat:update`) accept `--dry-run` by default. Append `--execute` only after the change ticket is approved.

---

## Change workflow

1. **Surface & doctor.** Run `npm run owner:surface -- --network <network>` to capture the active control surface, then `npm run owner:doctor -- --network <network>` to flag missing wiring or zero-value parameters.
2. **Plan.** Generate an executable diff with `npm run owner:plan -- --network <network> [--only moduleA,moduleB]`. Attach the Markdown table to the [Owner Control Change Ticket](owner-control-change-ticket.md) for approvals.
3. **Execute safely.** Use `npm run owner:update-all -- --network <network> --only moduleA,moduleB --execute` once approvals land. For emergency pauses, dispatch `npx hardhat run scripts/v2/updateSystemPause.ts --network <network> --execute --pause-all`.
4. **Verify.** Immediately confirm the chain matches the manifests with `npm run owner:verify-control -- --network <network> --strict`. Persist the JSON output in `reports/<network>-owner-verify-YYYYMMDD.json`.
5. **Archive & broadcast.** Capture telemetry with `npm run owner:snapshot -- --network <network>` and notify stakeholders via the owner console or incident channel when controls change.

Follow this workflow for every parameter mutation—routine or emergency—to maintain a tamper-evident record and keep the platform deployable by a non-technical owner.

