# AGI Jobs v2 Testnet Dry-Run Playbook

This guide introduces the automated dry-run harness that exercises the critical
production flows end-to-end before committing to a public testnet rehearsal or
mainnet launch. It complements the existing owner-control runbooks and fulfills
the "External Audit & Final Verification" sprint recommendation by providing a
repeatable smoke test for job execution and emergency controls.

## Why this matters

* **Pre-audit assurance.** The harness captures concrete evidence that core
  functions (job lifecycle, validator gating, emergency pausing, and governance
  parameter updates) behave as designed before auditors review the deployment
  artifacts.【F:scripts/v2/testnetDryRun.ts†L1-L391】【F:scripts/v2/testnetDryRun.ts†L392-L679】
* **Operator rehearsal.** The same scripted flow can be rerun after audit fixes
  or configuration changes, verifying that non-technical operators can execute
  the go-live checklist with confidence.【F:scripts/v2/testnetDryRun.ts†L681-L756】

## Running the rehearsal locally

```bash
npx hardhat compile
npm run owner:testnet:dry-run
```

The one-time compile step ensures all fully qualified contract artifacts are
available before the rehearsal begins. The script then deploys an ephemeral
Hardhat network fixture, runs a full job lifecycle (stake, post, deliver,
validate, finalize) and provisions a `SystemPause` stack through the on-chain
`Deployer` helper. Each step records transaction hashes, gas usage, and any
anomalies.

### JSON output

For CI pipelines or compliance reporting, emit structured JSON:

```bash
npm run owner:testnet:dry-run -- --json > reports/local-dry-run.json
```

The JSON payload includes scenario summaries, step-level metadata, and the final
status flag (pass/fail). Feed it into existing governance dashboards or attach
to audit evidence packages alongside the pause verification report generated by
`npm run pause:test`.【F:scripts/v2/pauseTest.ts†L1-L239】

## Continuous enforcement in CI

The `ci (v2)` workflow now executes the same rehearsal on every pull request via
the **Testnet dry-run rehearsal** job. The run pipes the JSON output into the
Actions summary and uploads the artifact so release captains can link evidence
directly from the Checks tab. A failure blocks merges, ensuring deployments only
progress when the owner controls, pause drills, and validator flows all pass the
scripted audit.【F:.github/workflows/ci.yml†L262-L320】

## Executing on a public testnet

1. **Deploy contracts** using the documented one-click or scripted flows.
2. **Run the dry-run harness** against the target network to confirm wiring:
   `npm run owner:testnet:dry-run -- --network <network>`.
3. **Cross-check SystemPause** readiness with `npm run pause:test` to ensure the
   production pauser multisig can halt and resume the protocol without manual
   intervention.【F:scripts/v2/pauseTest.ts†L240-L404】
4. **Document outcomes** by committing the generated JSON and terminal logs to
   the operations vault, closing the feedback loop required by the audit plan.
   Populate the [testnet dry-run evidence template](audit/testnet-dry-run-evidence-template.md)
   so auditors and change reviewers can confirm the dry-run transcript, pause
   drill, and owner parameter rehearsal without rerunning the scripts.

## Integrating with the readiness checklist

Add the dry-run harness to the "Green Path" readiness runbook after the contract
deployment and configuration phases. The recommended sequence is now:

1. Execute `npm run owner:plan` and verify governance signatures.
2. Run `npm run owner:testnet:dry-run` and confirm a fully green status.
3. Capture the pause verification report via `npm run pause:test`.
4. Proceed to incident tabletop drills or public audit sign-off.

By codifying this rehearsal, AGI Jobs v2 gains deterministic, repeatable proof
that the deployment artifacts, owner control surface, and incident response
tooling remain production-ready at every release.
