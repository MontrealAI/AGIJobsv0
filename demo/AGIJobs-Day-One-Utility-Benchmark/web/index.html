<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>AGI Jobs Day-One Utility — Live Telemetry Viewer</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
      :root {
        color-scheme: dark;
        --bg: #010718;
        --panel: rgba(12, 23, 42, 0.85);
        --accent: #38bdf8;
        --text: #f8fafc;
      }
      body {
        margin: 0;
        font-family: 'Space Grotesk', sans-serif;
        background: radial-gradient(circle at top, rgba(56,189,248,0.14), transparent 45%), var(--bg);
        color: var(--text);
        min-height: 100vh;
        display: flex;
        flex-direction: column;
      }
      header {
        padding: 2.5rem 5vw 1.5rem;
        text-align: center;
      }
      header h1 {
        font-size: clamp(2.4rem, 5vw, 3.6rem);
        margin-bottom: 0.4rem;
      }
      header p {
        margin: 0 auto;
        max-width: 70ch;
        line-height: 1.5;
        color: rgba(248,250,252,0.7);
      }
      main {
        flex: 1;
        padding: 0 5vw 4rem;
        display: grid;
        gap: 1.2rem;
      }
      .panel {
        background: var(--panel);
        border-radius: 18px;
        padding: 1.8rem;
        box-shadow: 0 35px 90px rgba(56,189,248,0.1);
        backdrop-filter: blur(12px);
      }
      .metrics-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
        gap: 1.2rem;
      }
      .metric {
        background: rgba(148, 163, 184, 0.14);
        border-radius: 16px;
        padding: 1rem;
        text-align: center;
      }
      .metric h3 {
        margin: 0;
        font-size: 0.9rem;
        text-transform: uppercase;
        letter-spacing: 0.08em;
      }
      .metric p {
        margin: 0.3rem 0 0;
        font-size: 1.7rem;
      }
      label {
        display: block;
        margin-bottom: 0.4rem;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.08em;
      }
      select {
        width: 100%;
        padding: 0.9rem 1rem;
        border-radius: 12px;
        border: 1px solid rgba(148,163,184,0.2);
        background: rgba(15,23,42,0.7);
        color: var(--text);
        font-size: 1rem;
      }
      pre {
        margin: 0;
        white-space: pre-wrap;
        word-break: break-word;
        font-size: 0.9rem;
        background: rgba(15,23,42,0.6);
        padding: 1rem;
        border-radius: 14px;
      }
      footer {
        text-align: center;
        padding: 2rem 0;
        color: rgba(226,232,240,0.6);
      }
      a {
        color: var(--accent);
      }
    </style>
  </head>
  <body>
    <header>
      <h1>AGI Jobs v0 (v2) — Day-One Utility Command Deck</h1>
      <p>
        Load the latest telemetry report generated by <code>run_demo.py</code> and explore
        mission metrics, owner controls, and guardrail verdicts in real time. Use
        the Makefile to produce new reports, then refresh this viewer.
      </p>
    </header>
    <main>
      <section class="panel">
        <label for="report">Select telemetry report</label>
        <select id="report">
          <option value="../out/report_e2e.json">Day-One Utility Benchmark (e2e)</option>
          <option value="../out/report_alphaevolve.json">AlphaEvolve Utility Surge</option>
          <option value="../out/report_hgm.json">Huxley-Gödel Machine</option>
          <option value="../out/report_trm.json">Total Revenue Maximizer</option>
          <option value="../out/report_omni.json">Omni-Concord Infinity Launch</option>
          <option value="../out/scoreboard.json">Multi-Strategy Scoreboard</option>
        </select>
      </section>
      <section class="panel">
        <div class="metrics-grid" id="metrics"></div>
      </section>
      <section class="panel">
        <h2>Raw payload</h2>
        <pre id="payload">Run a strategy to populate telemetry…</pre>
      </section>
    </main>
    <footer>
      Powered by AGI Jobs v0 (v2) — generated dashboards live in <code>out/</code>.
    </footer>
    <script>
      const select = document.getElementById('report');
      const payloadEl = document.getElementById('payload');
      const metricsEl = document.getElementById('metrics');

      async function loadReport(path) {
        try {
          const response = await fetch(path);
          if (!response.ok) {
            payloadEl.textContent = `Unable to load ${path}. Generate it with \`make\``;
            metricsEl.innerHTML = '';
            return;
          }
          const data = await response.json();
          payloadEl.textContent = JSON.stringify(data, null, 2);
          renderMetrics(data);
        } catch (error) {
          payloadEl.textContent = `Error loading report: ${error}`;
          metricsEl.innerHTML = '';
        }
      }

      function renderMetrics(data) {
        if (data.type === 'scoreboard') {
          const blocks = [];
          const leaders = data.leaders || {};
          if (leaders.utility_uplift && leaders.utility_uplift.value) {
            const leader = leaders.utility_uplift;
            blocks.push({
              label: 'Utility Leader',
              value: `${leader.title} (${(leader.value.utility_uplift * 100).toFixed(2)}%)`
            });
          }
          if (leaders.owner_treasury && leaders.owner_treasury.value) {
            const leader = leaders.owner_treasury;
            blocks.push({
              label: 'Treasury Leader',
              value: `${leader.title} (${leader.value.owner_treasury.toFixed(2)})`
            });
          }
          if (leaders.reliability && leaders.reliability.value) {
            const leader = leaders.reliability;
            blocks.push({
              label: 'Reliability Leader',
              value: `${leader.title} (${(leader.value.reliability_score * 100).toFixed(2)}%)`
            });
          }
          if (leaders.latency_p95 && leaders.latency_p95.value) {
            const leader = leaders.latency_p95;
            blocks.push({
              label: 'P95 Latency Leader',
              value: `${leader.title} (${leader.value.latency_p95.toFixed(3)}s)`
            });
          }
          if (Array.isArray(data.guardrail_failures)) {
            const failures = data.guardrail_failures.length;
            const noun = failures === 1 ? 'strategy' : 'strategies';
            blocks.push({ label: 'Guardrail Alerts', value: failures === 0 ? 'All Clear' : `${failures} ${noun}` });
          }
          if (data.aggregates) {
            blocks.push({
              label: 'Total Owner Treasury',
              value: data.aggregates.total_owner_treasury.toFixed(2)
            });
            blocks.push({
              label: 'Avg Utility Uplift',
              value: (data.aggregates.average_utility_uplift * 100).toFixed(2) + '%'
            });
            blocks.push({
              label: 'Avg Latency Delta',
              value: (data.aggregates.average_latency_delta * 100).toFixed(2) + '%'
            });
            blocks.push({
              label: 'Avg Latency P95',
              value: data.aggregates.average_latency_p95.toFixed(3) + 's'
            });
          }
          if (data.metrics && typeof data.metrics.best_latency_p95 === 'number') {
            blocks.push({
              label: 'Best P95 Latency',
              value: data.metrics.best_latency_p95.toFixed(3) + 's'
            });
          }
          metricsEl.innerHTML = blocks.map(block => `
            <div class="metric">
              <h3>${block.label}</h3>
              <p>${block.value}</p>
            </div>
          `).join('');
          return;
        }

        const metrics = data.metrics || {};
        const blocks = [];
        if (typeof metrics.utility_uplift === 'number') {
          blocks.push({ label: 'Utility Uplift', value: (metrics.utility_uplift * 100).toFixed(2) + '%' });
        }
        if (data.rules && typeof data.rules.utility_uplift_threshold === 'number') {
          blocks.push({ label: 'Utility Guardrail', value: (data.rules.utility_uplift_threshold * 100).toFixed(2) + '%' });
        }
        if (typeof metrics.latency_delta === 'number') {
          blocks.push({ label: 'Latency Delta', value: (metrics.latency_delta * 100).toFixed(2) + '%' });
        }
        if (typeof metrics.latency_p95 === 'number') {
          blocks.push({ label: 'Latency P95', value: metrics.latency_p95.toFixed(3) + 's' });
        }
        if (data.rules && typeof data.rules.max_latency_delta === 'number') {
          blocks.push({ label: 'Latency Guardrail', value: (data.rules.max_latency_delta * 100).toFixed(2) + '%' });
        }
        if (metrics.candidate && typeof metrics.candidate.utility === 'number') {
          blocks.push({ label: 'Candidate Utility', value: metrics.candidate.utility.toFixed(2) });
        }
        if (metrics.owner_treasury) {
          blocks.push({ label: 'Owner Treasury', value: metrics.owner_treasury.toFixed(2) });
        }
        if (data.strategy_profile && data.strategy_profile.reliability_score) {
          blocks.push({ label: 'Reliability Score', value: (data.strategy_profile.reliability_score * 100).toFixed(2) });
        }
        if (data.owner_controls && data.owner_controls.utility_threshold_override_bps !== undefined) {
          const override = data.owner_controls.utility_threshold_override_bps;
          const display = override === null ? '—' : `${override} bps`;
          blocks.push({ label: 'Utility Override', value: display });
        }
        if (data.owner_controls && data.owner_controls.latency_threshold_override_bps !== undefined) {
          const override = data.owner_controls.latency_threshold_override_bps;
          const display = override === null ? '—' : `${override} bps`;
          blocks.push({ label: 'Latency Override', value: display });
        }
        metricsEl.innerHTML = blocks.map(block => `
          <div class="metric">
            <h3>${block.label}</h3>
            <p>${block.value}</p>
          </div>
        `).join('');
      }

      select.addEventListener('change', () => loadReport(select.value));
      loadReport(select.value);
    </script>
  </body>
</html>
