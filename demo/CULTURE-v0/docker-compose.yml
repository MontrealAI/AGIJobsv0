version: "3.9"
services:
  culture-chain:
    image: ghcr.io/foundry-rs/foundry:latest
    command: ["anvil", "--host", "0.0.0.0", "--chain-id", "31337"]
    ports:
      - "8545:8545"

  culture-contracts:
    image: node:20.18.1
    depends_on:
      - culture-chain
    working_dir: /workspace
    volumes:
      - ..:/workspace
    command: ["npx", "hardhat", "run", "demo/CULTURE-v0/scripts/deploy.culture.ts", "--network", "localhost"]
    environment:
      - RPC_URL=http://culture-chain:8545
      - DEPLOYER_PRIVATE_KEY=${DEPLOYER_PRIVATE_KEY}
      - OWNER_ADDRESS=${OWNER_ADDRESS}
      - AGI_JOBS_CORE_ADDRESSES=${AGI_JOBS_CORE_ADDRESSES}

  culture-orchestrator:
    build:
      context: ..
      dockerfile: demo/CULTURE-v0/backend/arena-orchestrator/Dockerfile
    env_file: .env
    depends_on:
      - culture-contracts
    ports:
      - "${ORCHESTRATOR_PORT:-4005}:4005"

  culture-indexer:
    build:
      context: ..
      dockerfile: demo/CULTURE-v0/indexers/culture-graph-indexer/Dockerfile
    env_file: .env
    depends_on:
      - culture-contracts
    ports:
      - "${INDEXER_PORT:-4100}:4100"

  culture-studio:
    build:
      context: ..
      dockerfile: demo/CULTURE-v0/apps/culture-studio/Dockerfile
    env_file: .env
    depends_on:
      - culture-orchestrator
      - culture-indexer
    ports:
      - "4173:4173"
