name: demo-aurora

on:
  pull_request:
    paths:
      - 'demo/**'
      - '.github/workflows/demo-aurora.yml'
  workflow_dispatch:

permissions:
  contents: read

jobs:
  aurora-local:
    runs-on: ubuntu-latest
    timeout-minutes: 20
    steps:
      - uses: actions/checkout@v4

      - name: Harden runner
        uses: step-security/harden-runner@v2.13.1
        with:
          egress-policy: block
          allowed-endpoints: >
            api.github.com
            github.com
            objects.githubusercontent.com
            raw.githubusercontent.com
            registry.npmjs.org
            nodejs.org

      - name: Setup Node
        uses: actions/setup-node@v4
        with:
          node-version-file: '.nvmrc'
          cache: 'npm'

      - name: Install
        run: npm ci

      - name: Setup Foundry
        uses: foundry-rs/foundry-toolchain@v1
        with:
          version: stable

      - name: Run AURORA (local)
        env:
          PRIVATE_KEY: '0x59c6995e998f97a5a004497e5d6a897bcf7a20a0aa2a0b3f1d0ad6bdfb9c0001'
          WORKER_PRIVATE_KEY: '0x8b3a350cf5c34c9194ca8afc2a0eae2b2aeeafce0c12cf5f8f1b2e7ab6fce201'
          VALIDATOR_PRIVATE_KEY: '0x0f4b9bf3efb59c0a8b6dfa8172932d03cd4b16ba29cf15f9272972d4d8f90b02'
          RPC_URL: 'http://127.0.0.1:8545'
          CHAIN_ID: '31337'
        run: bash demo/aurora/bin/aurora-local.sh

      - name: Upload demo receipts
        uses: actions/upload-artifact@v4
        with:
          name: aurora-receipts
          path: reports/localhost/aurora/**
